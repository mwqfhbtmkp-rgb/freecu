<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FREECU â€” Last Stand Tower</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
*{
  box-sizing:border-box;
  user-select:none;
  image-rendering:pixelated;
  font-family:Arial, sans-serif;
}

body{
  margin:0;
  background:#0b0f1a;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  color:#e5e7eb;
}

#game{
  width:1000px;
  max-width:100%;
  height:300px;
  background:linear-gradient(#020617,#0f172a);
  border:3px solid #2c3145;
  position:relative;
  overflow:hidden;
}

/* HUD */
#hud{
  position:absolute;
  top:15px;
  left:15px;
  font-size:14px;
  z-index:10;
}

#log{
  margin-top:8px;
  font-size:12px;
  color:#f97316;
}

#lost{
  margin-top:4px;
  font-size:12px;
  color:#ef4444;
}

/* SLOTS */
#slots{
  position:absolute;
  bottom:60px;
  left:120px;
  display:flex;
  gap:60px;
}

.slot{
  width:34px;
  height:34px;
  border:2px dashed #334155;
  position:relative;
}

/* TOWER */
.tower{
  width:34px;
  height:60px;
  background:
    repeating-linear-gradient(
      90deg,
      #9ca3af 0px,
      #9ca3af 4px,
      #6b7280 4px,
      #6b7280 8px
    );
  border:2px solid #374151;
  position:absolute;
  bottom:0;
  left:-2px;
}

/* ENEMY */
.enemy{
  width:24px;
  height:24px;
  background:#dc2626;
  position:absolute;
  bottom:60px;
}

/* FLASH */
.flash{
  position:absolute;
  inset:0;
  background:rgba(239,68,68,0.25);
  pointer-events:none;
  animation:flash .3s ease;
}

@keyframes flash{
  from{opacity:1;}
  to{opacity:0;}
}

/* OVERLAY */
#overlay{
  position:absolute;
  inset:0;
  background:rgba(2,6,23,.9);
  display:flex;
  justify-content:center;
  align-items:center;
  text-align:center;
  font-size:18px;
  z-index:20;
}

.hidden{display:none;}
</style>
</head>

<body>

<div id="game">

  <div id="hud">
    Towers lost: <span id="lostCount">0</span>
    <div id="log"></div>
    <div id="lost"></div>
  </div>

  <div id="slots"></div>

  <div id="overlay">Click to begin</div>

</div>

<script>
const game = document.getElementById("game");
const overlay = document.getElementById("overlay");
const slotsContainer = document.getElementById("slots");
const lostCountEl = document.getElementById("lostCount");
const logEl = document.getElementById("log");
const lostEl = document.getElementById("lost");

let slots=[];
let enemies=[];
let running=false;
let spawnTimer=0;
let lostCount=0;

function createSlots(){
  slotsContainer.innerHTML="";
  slots=[];
  for(let i=0;i<5;i++){
    const s=document.createElement("div");
    s.className="slot";
    s.tower=null;
    slotsContainer.appendChild(s);
    slots.push(s);
  }

  // place 3 initial towers
  [0,2,4].forEach(i=>addTower(slots[i]));
}

function addTower(slot){
  const t=document.createElement("div");
  t.className="tower";
  t.hp=6;
  slot.appendChild(t);
  slot.tower=t;
}

function spawnEnemy(){
  const e=document.createElement("div");
  e.className="enemy";
  e.x=-30;
  e.hp=3;
  game.appendChild(e);
  enemies.push(e);
}

function towerLost(slot){
  slot.tower.remove();
  slot.tower=null;
  lostCount++;
  lostCountEl.textContent=lostCount;
  logEl.textContent="A tower has fallen";
  lostEl.textContent="Permanent loss";

  const flash=document.createElement("div");
  flash.className="flash";
  game.appendChild(flash);
  setTimeout(()=>flash.remove(),300);

  if(slots.every(s=>!s.tower)){
    gameOver();
  }
}

function gameOver(){
  running=false;
  overlay.innerHTML=`No defenses remain<br><br>Towers lost: ${lostCount}`;
  overlay.classList.remove("hidden");
}

function loop(){
  if(!running)return;

  spawnTimer++;
  if(spawnTimer>120){
    spawnEnemy();
    spawnTimer=0;
  }

  enemies.forEach(e=>{
    let blocked=false;

    slots.forEach(s=>{
      if(!s.tower||blocked)return;
      const sRect=s.getBoundingClientRect();
      const eRect=e.getBoundingClientRect();
      if(eRect.right>=sRect.left){
        blocked=true;
        s.tower.hp--;
        e.hp--;
        if(s.tower.hp<=0)towerLost(s);
        if(e.hp<=0)e.remove();
      }
    });

    if(!blocked){
      e.x+=1;
      e.style.left=e.x+"px";
    }
  });

  enemies=enemies.filter(e=>e.isConnected);

  requestAnimationFrame(loop);
}

game.addEventListener("pointerdown",()=>{
  if(!running){
    lostCount=0;
    lostCountEl.textContent="0";
    logEl.textContent="";
    lostEl.textContent="";
    enemies.forEach(e=>e.remove());
    enemies=[];
    spawnTimer=0;
    createSlots();
    overlay.classList.add("hidden");
    running=true;
    loop();
  }
});
</script>

</body>
</html>